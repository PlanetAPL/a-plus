ãã Copyright (c) 1990-2008 Morgan Stanley All rights reserved.
ãã See .../src/LICENSE for terms of distribution.
$cx afm

USERNAMEûsys.getusername{}

set_files{s;d;i;p;c;v}:
	{
	(c%`_FILE)û'';
	xûsys.agetdents{c%`_DIR};
	if (0<#s Ý sûc%`_SUFFIX)
		{
		xûôx;
		dû-#s;
		xûô(-+/^\÷x=' ')÷x;
		xûdÕ@1(^/@1 (dÙ@1 x)=@1 s)/x;
		xû(~^/~©\@1 ' '¨x)/@1 x;
		xû((x=' ')É@1Û0)÷@0 1x;
		};
	(c%`_FILES)û(èx)#x;
	(c,`_FILES) .has (`row;¢1);
	}

dltb{x}:((÷©\÷x¨' ')^©\x¨' ')/x

select_file{s;c;v}:(c%`_FILE)ûif (¢1=rû0Ø`row .of c,v) '' else dltb{r#c%v},c%`_SUFFIX

preset_mode{s;d;i;p;c;v}:if (dÅ0Øc%`_MODES) d else Ù`domain
set_mode{s;d;i;p;c;v}:(dØc%`_MODES)û1 Ý (1Øc%`_MODES)ûÛ¡d=0Øc%`_MODES

set_modes{s;d;i;p;c;v}:
	{
	if (`sym¨©p) û();
	(c,`_MODE) _spcb (;);
	(c,`_MODE) _scb (;);
	(c%`_MODE)ûp;
	(c,`_MODE) _spcb (preset_mode;);
	(c,`_MODE) _scb (set_mode;);
	case (p)
		{
		`get;	get_mode{c};
		`put;	put_mode{c};
		`drop;	drop_mode{c};
		}
	}

get_mode{c}:(c,`_USER) .has (`protect;0) Ý (c%`_TRIGGER)ûc%`_TRIGGER Ý (c,`_NEW) .has (`protect;1) Ý (c%`_NEW)û''
put_mode{c}:(c,`_USER) .has (`protect;1) Ý (c%`_USER)ûUSERNAME Ý (c,`_NEW) .has (`protect;0)
drop_mode{c}:(c,`_USER) .has (`protect;1) Ý (c%`_USER)ûUSERNAME Ý (c,`_NEW) .has (`protect;1) Ý (c%`_NEW)û''

define{cx}:
	{
	WSûs.autows{()};

	(cx%`_FONT)û'kaplscreen-bold';

	(cx%`_MODE)û`get;

	(cx%`_USER)ûUSERNAME;
	(cx%`_FILE)û'';
	(cx%`_APPL)û'';
	(cx%`_SUFFIX)û'';
	(cx%`_TRIGGER)û0;

	cxâ"_DIR:'/u/',_USER,'/',_APPL,'/'";

	(cx%`_FILES)û0 0Ò'';

	(cx%`_MODES)û(`get `put `drop;(1;0;0));
	(cx%`_NEW)û'';
	(cx%`_AFM)û(`_MODES;`_USER;`_FILES;`_NEW);

	(cx,`_MODES) .is `radio;
	(cx,`_USER) .is `scalar;
	(cx,`_FILES) .is `view;
	(cx,`_NEW) .is `scalar;
	(cx,`_AFM) .is `layout;

	(cxÖ`_USER `_APPL `_SUFFIX `_TRIGGER) _scb¡<(set_files;);

	fûcxÖ`_FONT;

	(cx,`_MODES) s.uses (`font;f;`titlefont;f;`labelfont;f);
	(cx,`_USER) s.uses (`font;f;`titlefont;f);
	(cx,`_NEW) s.uses (`font;f;`titlefont;f);
	(cx,`_FILES) s.uses (`font;f;`titlefont;f);

	(cx,`_MODE) .has (`preset;preset_mode;`set;set_mode);
	(cx,`_MODES) .has (`title;'';`geometry;`horizontal;`label;`Get `Put `Drop;`set;set_modes;`acceptfocus;0);
	(cx,`_USER) .has (`title;'User:');
	(cx,`_FILES) .has (`title;'Current Files';`rows;7;`select;select_file);
	(cx,`_NEW) .has (`title;'New:');
	(cx,`_AFM) .has (`title;'');
	
	s.autows{WS};

	cxÖ`_AFM
	}
