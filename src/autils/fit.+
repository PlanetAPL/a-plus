ãã Copyright (c) 1990-2008 Morgan Stanley All rights reserved.
ãã See .../src/LICENSE for terms of distribution.

$cx fit

set_size{s;d;i;p;c;v}:(c%`_FONT)ûc%`_FONT
in_size{s;d;i;p;c;v}:if (^/d=' ') ¢1 else if (0=rc İ (rc;z)ûdo _sfi{d}) z
out_size{s;d;i;p;c;v}:if (d=¢1) ' ' else 1Õîd

etom{v}:>(Ó/Ø#¡v)Ù¡v

set_cb{c;v;z}:(c,v) .has (`preset;z)
unset_cb{c;v}:z İ (c,v) .has (`preset;) İ zû0Ø`preset .of c,v
refer_cf{s;c;v}:set_cb{c;s;cb} İ x_on_y{c;z} İ (c%s)ûz İ zû(0Ø`row .of c,v)#c%v İ cbûunset_cb{c;s}

x_on_y{c;k}:
	{
	if (¢1<s İ sûc%`_SIZE) kûÂ(Îk),'-',1Õîs;
	(c,`_FIT) .has (`freeze;1);
	(cÖc%`_CHARS) .has¡4Ò<(`font;k);
	(c,`_INP) .has (`font;k);
	(c,`_FIT) .has (`freeze;0);
	}

find{c;v;d;r}:if ((#g)=iûgÉd İ gû(#d)Ù@1Îf İ fûr÷c%v) ¢1 else k İ kû(#g)|r+i

set_cfs{s;d;i;p;c;v}:(c,v) .has (`row `firstrow;2Òk) İ kû(c%v)Éc%s

preset_cf{s;d;i;p;c;v}:
	{
	if (¢1=k İ kûfind{c;s;Îd;1+0Ó0Ø`row .of c,s}) Ù() 
	else z İ x_on_y{c;z} İ (c,s) .has (`row `firstrow;2Òk) İ zûk#c%s
	}

out_sym{s;d;i;p;c;v}:if (`sym=©d) Îd else ''
in_sym{s;d;i;p;c;v}:if (`char=©d) Âd else `

define{cx}:
	{
	WSûs.autows{()};

	(cx%`_UNSHIFT)ûetom{(
			'1234567890-=\ ';
			'qwertyuiop[] ';
			'asdfghjkl;''` ';
			'zxcvbnm,./ '
			)};

	(cx%`_SHIFT)ûetom{(
			'!@#$%^&*()_+| ';
			'QWERTYUIOP{} ';
			'ASDFGHJKL:"~ ';
			'ZXCVBNM<>?Û '
			)};

	(cx%`_META)ûetom{(
			'¡¢<¤=¦>¨©^«ßã ';
			'?×ÅÒ~ÙÕÉÏ*ûı ';
			'ÁÓÄ_ÇÈÊ''ÌÛİş ';
			'ÚØÃÖÂÎ|ìÜ¯ '
			)};

	(cx%`_METASHIFT)ûetom{(
			'àæçè÷ôáğ¹°!­ü ';
			'¿×åÒÔ´Õéï³İ Û';
			'Á¾Ä½çèêËì¼» ş';
			'úØãÖâîÍ¼®¿'
			)};

	(cx%`_INP)û'';
	(cx%`_SIZE)û¢1;
	(cx%`_FONTS)û();
	(cx%`_CHARS)û`_UNSHIFT `_SHIFT `_META `_METASHIFT;
	(cx%`_CI)û`_INP `_CHARS;
	(cx%`_FS)û(`_FONT `_SIZE;`_FONTS);
	(cx%`_FIT)û<`_FS `_CI;

	(cx%`_FONT)ûÂ0Ø`font .of cx,`_INP;

	(cx,`_INP) .is `scalar;
	(cx,`_SIZE) .is `scalar;
	(cx,`_FONT) .is `scalar;
	(cx,`_FONTS) .is `array;
	(cx,`_UNSHIFT) .is `label;
	(cx,`_SHIFT) .is `label;
	(cx,`_META) .is `label;
	(cx,`_METASHIFT) .is `label;
	(cx,`_CHARS) .is `vpane;
	(cx,`_CI) .is `layout;
	(cx,`_FS) .is `layout;
	(cx,`_FIT) .is `hpane;

	(cx,`_FONTS) .has (`refer;(refer_cf;`_FONT);`font;'kaplscreen-bold';`out;out_sym;`protect;1;`space;31;`title;'');
	(cx,`_FONT) .has (`preset;(preset_cf;`_FONTS);`title;'';`out;out_sym;`in;(in_sym;`_FONTS);`font;'kaplscreen-bold');	
	(cx,`_FONTS) .has (`set;(set_cfs;`_FONT));
	(cx,`_SIZE) .has (`title;'';`out;out_size;`in;in_size;`set;set_size;`space;5;`resize;'wW';`font;'kaplscreen-bold');
	(cx,`_FS) .has (`title;'');
	(cx,`_CI) .has (`title;'');
	(cx,`_CHARS) .has (`title;'');
	(cx,`_INP) .has (`resize;'hH';`title;'');
	(cx,`_FIT) .has (`title;'';`locksize;1;`realize;1;`yxs;500 800);

	s.autows{WS};

	cxÖ`_FIT
	}
