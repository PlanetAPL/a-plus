ãã Copyright (c) 1990-2008 Morgan Stanley All rights reserved.
ãã See .../src/LICENSE for terms of distribution.

$cx bxt

SHAPEû20 35

define{cx}:
	{
	WSûs.autows{()};

	(cx%`_SYMBOLS)û();
	(cx,`_SYMBOLS) _scb (set_symbols;);
	(cx%`_OBJECTS)û(;);
	(cx%`_OBJECT)û();
	(cx%`_PAGE)ûSHAPEÒ' ';
	(cx%`_COLOR)ûSHAPEÒ¢1;
	(cx%`_BOX)û0 4Ò0;
	(cx%`_COLORS)û`red `orange `yellow `green `cyan `violet;
	cxâ'_COLOR_MAP:ô`black~_COLORS';
	(cx%`_BOXED)û(;);
	(cx%`_CUT)û<{cut};
	(cx%`_BXT)û(`_OBJECTS `_CUT;`_PAGE);

	(cx,`_OBJECTS) .is `choice;
	(cx,`_CUT) .is `button;
	(cx,`_PAGE) .is `page;
	(cx,`_BXT) .is `layout;

	(cx,`_PAGE) s.uses (`box;cxÖ`_BOX;`color;cxÖ`_COLOR;`colormap;cxÖ`_COLOR_MAP);

	(cx,`_OBJECTS) .has (`title;'Object';`acceptfocus;0;`set;set_objects;`cols;3);
	(cx,`_CUT) .has (`title;'Cut';`acceptfocus;0;`resize;'wW');
	(cx,`_PAGE) .has (`title;'';`rband;rband;`shadowthickness;2;`resize;'HWtl');
	(cx,`_BXT) .has (`title;'';`resizeable;0);

	s.autows{WS};

	cxÖ`_BXT
	}

set_symbols{s;d;i;p;c;v}:
	{
	(c%`_OBJECTS)û(k;Û¡(#k)Ù1) Ý kû,c%v;
	(c%`_OBJECT)ûif (0<#k) 0#k;
	}

set_objects{s;d;i;p;c;v}:if (`sym=©p) (c%`_OBJECT)ûp

cut{s;c;v}:remove{c;1}

remove{c;flag}:
	{
	if (()½ob Ý obûc%`_OBJECT) û();
	if (obÅ0Øbxd Ý bxdûc%`_BOXED)
		{
		iûobØbxd;
		(bx;clr)ûc%¡`_BOX `_COLOR;
		rbûi#c%`_BOX;
		(i#c%`_BOX)û0;
		(rs;cs)û(rb[0]+Érb[2];rb[1]+Érb[3]);
		((rs;cs)#c%`_COLOR)û¢1;
		((rs;cs)#c%`_PAGE)û' ';
		(c%`_BOXED)û(<ob¨0Øbxd)/¡bxd;
		}
	}

overlaps{c;rb}:
	{
	if (obÅ0Øbxd Ý bxdûc%`_BOXED Ý obûc%`_OBJECT Ý bxûc%`_BOX) bxû((obØbxd)¨É#bx)/bx;
	if (0=#bx) 0 else ©/bx s.overlaps@1 1 rb
	}

rband{s;c;v}:
	{
	if (()½ob Ý obûc%`_OBJECT) û();
	rbû0Ø`rbandbox .of c,v;
	rb[2 3]û1Órb[2 3];
	if (overlaps{c;rb}) û();
	nûÎob;
	remove{c;0};
	kû(c%`_BOX)É0 0 0 0;
	if (k<#c%`_BOX) (k#c%`_BOX)ûrb else (c%`_BOX)[,]ûrb;
	(c%`_BOXED)û(c%`_BOXED),¡(ob;<k);
	label{c;rb;k;n};
	}

label{c;rb;k;n}:
	{
	cnû#n;
	(rs;cs)û(rb[0]+Érb[2];rb[1]+Érb[3]);
	((rs;cs)#c%`_COLOR)û(#c%`_COLORS)|k;
	tûif (cn¤#cs) 0 else if (cn¤#rs) 1 else (#rs)>#cs;
	(ridx;cidx)ûif (t) (many{rs;cn};one{cs}) else (one{rs};many{cs;cn});
	((ridx;cidx)#c%`_PAGE)û(tØ(#cidx;#ridx))Ùn;
	}

one{x}:(Ä.5«#x)#x
many{x;cn}:d+ÉÄ/cn,(x[0]+#x)-d Ý dûx[0]Ó((Ä.5«#x)#x)-Ä.5«cn






