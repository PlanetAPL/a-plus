ãã Copyright (c) 1990-2008 Morgan Stanley All rights reserved.
ãã See .../src/LICENSE for terms of distribution.

$cx fkt

set_fkt{s;d;i;p;c;v}:(c%`_FAMILY)ûp
set_family{s;d;i;p;c;v}:if (~()½d) (kû#c%`_KINDS Ý fû(c%`_FAMILIES)Éd) do set_matrix{s;d;(k;f);;c;`_KIND_BY_FAMILY}
set_families{s;d;i;p;c;v}:(c,`_KIND_BY_FAMILY) .has (`label;('';Î¡c%`_KINDS;Î¡c%v))
set_kinds{s;d;i;p;c;v}:(c,`_KIND_BY_FAMILY) .has (`label;('';Î¡c%v;Î¡c%`_FAMILIES))

set_matrix{s;d;i;p;c;v}:
	{
	if (i½()) set_fkt{;;;c%`_FAMILY;c;}
	else
		{
		if (()½0Øi) (0Øi)ûÉ0#Òc%v;
		if (()½1Øi) (1Øi)ûÉ1#Òc%v;
		if (fÅ1Øi Ý fû(c%`_FAMILIES)Éc%`_FAMILY) ((c%`_CX)%¡k#c%`_KINDS)û(k;f)#c%v Ý kû0Øi
		}
	}

define{cx}:
	{
	WSûs.autows{()};

	(cx%`_CX)ûcx;
	(cx%`_FAMILY)û();
	(cx,`_FAMILY) _scb (set_family;);

	(cx%`_FAMILIES)û();
	(cx%`_KINDS)û();
	(cx%`_KIND_BY_FAMILY)û0 0Ò();
	
	cxâ'_FKT:(_FAMILIES;<@0_FAMILIES=_FAMILY)';

	(cx,`_FKT) .is `choice;
	(cx,`_FAMILIES) .is `array;
	(cx,`_KINDS) .is `array;
	(cx,`_KIND_BY_FAMILY) .is `matrix;

	(cx,`_FKT) .has (`title;'Family: ';`set;set_fkt);
	(cx,`_FAMILIES) .has (`title;'Families';`set;set_families;);
	(cx,`_KINDS) .has (`title;'Kinds';`set;set_kinds;);
	(cx,`_KIND_BY_FAMILY) .has (`title;'Kinds « Families';`set;set_matrix);

	s.autows{WS};

	cxÖ`_FKT
	}


