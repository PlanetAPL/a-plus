ãã Copyright (c) 1990-2008 Morgan Stanley All rights reserved.
ãã See .../src/LICENSE for terms of distribution.

$cx apl

if( ()½scriptsDirûsys.readenv{"UTILS_DIR"} ) {
  scriptsDirû"/usr/local/aplus-fsf-4.22/autils";
}

_load{scriptsDir,"/disp"}

disp.LINEû1

vcat{a;b}:a,b Ý (a;b)ûcase («(¢1ÙÒa)-¢1ÙÒb) {¢1;((¢1ÙÒb)Ù@1 a;b);0;(a;b);1;(a;(¢1ÙÒa)Ù@1 b)}

in{s;d;i;p;c;v}:
	{
	(ret;msg)ûif (0¨rc Ý (rc;z)ûdoâd) (;z)
	else ('';'') Ý (c%`_OUT)ûvcat{c%`_OUT;vcat{(5Ò" "),d;disp.lay{z}}};
	(c,`_OUT) .has (`firstrow;1e6);
	(c%`_MSG)ûmsg;
	ret
	}

OPTIONSû_alsf{
	(
	`Line;	`LINE;
	Â"û ý";	`HOR;
	Â"É";	`IOTA;
	`Tree;	`TREE;
	Â"Ù Õ";	`VER;
	Â"½";	`SAME
	)
}

set_check{s;d;i;p;c;v}:if (`sym=©p) (`disp%pØOPTIONS)ûd

clear{s;c;v}:
	{
	(c%`_OUT)û0 0Ò'';
	(c%`_IN)û'';
	(c%`_MSG)û'';
	}

refer{s;c;v}:
	{
	(c%`_IN)ût Ý tû(+/^\t=' ')Õt Ý tû(0Ø`row .of c,v)#c%v;
	(c,`_IN) .has (`edit;1;`focus;1);
	}

set_fmt{s;d;i;p;c;v}:(`disp%s)û(d¨' ')/d

define{cx}:
	{
	WSûs.autows{()};

	cxâ'_OPTIONS:(0Øapl.OPTIONS;(',(1ÕØ';',¡Î¡`dispÖ>1ØOPTIONS),'))';
	cxâ'_INT:disp.INT';
	cxâ'_FLOAT:disp.FLOAT';
	(cx%`_FORMATS)û`_INT `_FLOAT;

	(cx%`_OUT)û0 0Ò'';
	(cx%`_IN)û'';
	(cx%`_CLEAR)û<{clear};
	(cx%`_MSG)û'';
	(cx%`_APL)û(`_CLEAR;`_OPTIONS `_FORMATS;`_OUT;`_MSG;`_IN);
	
	(cx,`_OUT) .is `view;
	(cx,`_IN) .is `scalar;
	(cx,`_INT) .is `scalar;
	(cx,`_FLOAT) .is `scalar;
	(cx,`_CLEAR) .is `button;
	(cx,`_MSG) .is `label;
	(cx,`_OPTIONS) .is `check;
	(cx,`_FORMATS) .is `layout;
	(cx,`_APL) .is `layout;

	(cx,`_OUT) .has (`title;'';`refer;refer);
	(cx,`_FORMATS) .has (`title;'';`resize;'thH');
	(cx,`_CLEAR) .has (`title;'Clear');
	(cx,`_OPTIONS) .has (`acceptfocus;0;`C;1;`resize;'wW';`title;'';`set;set_check;`geometry;3);
	(cx,`_IN) .has (`title;'â: ';`in;in);
	(cx,`_FLOAT) .has (`title;'  Float: ';`set;(set_fmt;`FLOAT));
	(cx,`_INT) .has (`title;'Integer: ';`set;(set_fmt;`INT));
	(cx,`_APL) .has (`title;'');

	s.autows{WS};

	cxÖ`_APL
}